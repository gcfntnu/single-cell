#-*- mode:snakemake -*-

extra_conf_fn = srcdir('umitools.config')
if os.path.exists(extra_conf_fn):
    with open(extra_conf_fn) as fh:
        c  = yaml.load(fh) or {}
        update_config2(config, c)

include:
    'cellranger.rules'
    
#config
FASTQ_DIR = config.get('fastq_dir', 'data/raw/fastq')
UMI_PROCESSED = join(PROCESSED_DIR, 'umitools')
REF = config['quant']['reference']

def get_fastq(wildcards):
    return join(FASTQ_DIR, config['samples'][wildcards.sample]['R1'])

rule umitools_whitelist:
    input:
        R1 = get_fastq
    params:
        '--bc-pattern=CCCCCCCCCCCCCCCCNNNNNNNNNN --set-cell-number=1000'
    output:
        'data/tmp/umitools/whitelist.txt'
    shell:
        'umi_tools whitelist '
        '--stdin {input.R1} '
        '--log2stderr '
        '> {output}'

